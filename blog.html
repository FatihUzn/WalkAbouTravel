<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Journal - WalkAbouTravel</title>
    <link rel="icon" type="image/png" href="assets/walkabou_travel_logo.webp">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <link rel="stylesheet" href="style.css?v=2.0">
</head>
<body>

<header id="main-header">
  <div class="header-top-row">
    <div class="top-bar-left">
      <a href="tel:+902125551923" class="btn btn-top-info"><i class="fas fa-phone"></i> +90 (212) 555 1923</a>
      <a href="mailto:info@walkaboutravel.com" class="btn btn-top-info"><i class="fas fa-envelope"></i> info@walkaboutravel.com</a>
    </div>
    <div class="top-bar-right">
      <a href="index.html" class="btn btn-top-info"><i class="fas fa-home"></i> Anasayfaya Dön</a>
    </div>
  </div>

  <div class="header-bottom-row">
    <div class="brand">
      <img src="assets/walkabou_travel_logo.webp" alt="WalkAbouTravel Logo">
      <div class="brand-text-container">
          <span class="brand-title">WalkAbouTravel</span>
          <span class="brand-tagline">Tourism & Travel</span>
      </div>
    </div>
  </div>
</header>

<section class="blog-page-wrapper">
    
    <div class="blog-hero">
        <h1>The Journal</h1>
        <p>Seyahat dünyasından en son haberler, mimari incelemeler ve lüks yaşam üzerine notlar.</p>
    </div>

    <div id="featured-post-container">
        <p style="text-align: center; color: #666;">Yazılar yükleniyor...</p>
    </div>

    <div id="blog-grid-display" class="blog-grid-display"></div>

    <div style="text-align: center; margin-top: 80px; margin-bottom: 20px;">
        <button onclick="toggleAdminPanel()" style="background:none; border:none; color:#333; font-size:12px; cursor:pointer; font-family:'Inter',sans-serif;">Editör Girişi</button>
    </div>

    <div id="admin-panel-container" class="aesthetic-admin" style="display: none;">
        <h3>Yeni Yazı Yayınla (Demo)</h3>
        <p style="color: #666; font-size: 0.8rem; margin-bottom: 20px;">Not: Buradan eklenen yazılar sadece sizin tarayıcınızda görünür (Local Storage). Kalıcı olması için JSON dosyasına eklemelisiniz.</p>
        
        <input type="text" id="blog-title" class="aesthetic-input" placeholder="Yazı Başlığı...">
        <input type="text" id="blog-image" class="aesthetic-input" placeholder="Görsel Yolu (örn: assets/resim.webp)">
        <input type="date" id="blog-date" class="aesthetic-input">
        <textarea id="blog-content" class="aesthetic-input" rows="6" placeholder="Yazı içeriği (HTML formatı destekler)..."></textarea>
        
        <div style="display: flex; gap: 15px;">
            <button onclick="publishBlogPost()" class="btn" style="background: var(--blue-dark); color:#fff; border:none;">YAYINLA</button>
        </div>
    </div>

</section>

<footer class="site-footer">
    <div class="footer-bottom" style="text-align: center; border:none; padding-top: 20px;">
        © 2025 WalkAbouTravel Kurumsal Seyahat. Tüm hakları saklıdır.
    </div>
</footer>

<div id="blog-modal" class="blog-modal-overlay">
    <div class="blog-modal-content">
        <button class="close-modal-btn" onclick="closeBlogModal()">×</button>
        <div class="blog-modal-body">
            <img id="modal-img" src="" alt="Blog Detay">
            <span id="modal-date" class="modal-date"></span>
            <h2 id="modal-title"></h2>
            <div id="modal-text" class="modal-text"></div>
        </div>
    </div>
</div>

<script>
    // Blog verilerini tutacak değişken
    let blogPosts = [];

    // === 1. VERİLERİ ÇEKME FONKSİYONU ===
    async function loadBlogData() {
        try {
            // A) Önce JSON dosyasını çekmeye çalış
            const response = await fetch('data/blog-posts.json');
            
            if (!response.ok) {
                throw new Error("JSON dosyası bulunamadı veya yüklenemedi.");
            }
            
            const jsonData = await response.json();
            blogPosts = jsonData; // JSON verilerini ana değişkene ata

            // B) Local Storage'daki (Admin panelinden eklenen) verileri de ekle
            const localData = JSON.parse(localStorage.getItem('goldenBlogData')) || [];
            if(localData.length > 0) {
                // JSON ve Local veriyi birleştir
                blogPosts = blogPosts.concat(localData);
            }

            // C) Ekrana Bas
            renderBlogPosts();

        } catch (error) {
            console.error("Hata:", error);
            document.getElementById('featured-post-container').innerHTML = 
                `<p style='color:white; text-align:center;'>Veriler yüklenirken hata oluştu. Lütfen "Live Server" kullandığınızdan emin olun.<br><small>${error.message}</small></p>`;
        }
    }

    // === 2. EKRANA BASMA (RENDER) ===
    function renderBlogPosts() {
        const gridDisplay = document.getElementById('blog-grid-display');
        const featuredContainer = document.getElementById('featured-post-container');
        
        if(!gridDisplay) return;

        // Tarihe göre sırala (En yeniden eskiye)
        blogPosts.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Eğer hiç veri yoksa dur
        if (blogPosts.length === 0) {
            featuredContainer.innerHTML = "<p style='color:white; text-align:center;'>Henüz blog yazısı bulunmuyor.</p>";
            return;
        }

        // --- ÖNE ÇIKAN YAZI (En güncel olan) ---
        const latestPost = blogPosts[0];
        if(featuredContainer) {
            featuredContainer.innerHTML = `
                <article class="featured-post">
                    <div class="featured-img-container">
                        <img src="${latestPost.image}" alt="${latestPost.title}" onerror="this.src='https://placehold.co/800x600/111/f59e0b?text=WalkAbouTravel'">
                    </div>
                    <div class="featured-content">
                        <span class="post-meta"><i class="far fa-clock"></i> ${latestPost.date} | EDİTÖRÜN SEÇİMİ</span>
                        <h2>${latestPost.title}</h2>
                        <p>${latestPost.summary}</p>
                        <button onclick="openBlogModal(${latestPost.id})" class="read-more-link" style="background:none; border:none; cursor:pointer; font-size:1rem; border-bottom:1px solid var(--blue-light); padding:0;">
                            Yazıyı Oku <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </article>
            `;
        }

        // --- DİĞER YAZILAR (Grid) ---
        gridDisplay.innerHTML = ""; 
        const otherPosts = blogPosts.slice(1); // İlk yazıyı atla

        otherPosts.forEach(post => {
            const html = `
                <article class="aesthetic-card" onclick="openBlogModal(${post.id})">
                    <div class="card-img-top">
                        <img src="${post.image}" alt="${post.title}" loading="lazy" onerror="this.src='https://placehold.co/600x400/111/f59e0b?text=Blog'">
                    </div>
                    <div class="card-body">
                        <span class="card-date">${post.date}</span>
                        <h3>${post.title}</h3>
                        <p class="card-excerpt">${post.summary}</p>
                        <span class="read-more-link" style="color:var(--text-muted); font-size:0.9rem; margin-top:auto;">Devamını Oku →</span>
                    </div>
                </article>
            `;
            gridDisplay.innerHTML += html;
        });
    }

    // === 3. MODAL (POPUP) FONKSİYONLARI ===
    function openBlogModal(id) {
        // Tıklanan ID'ye ait yazıyı bul
        const post = blogPosts.find(p => p.id === id);
        if (!post) return;

        // Modal içeriğini doldur
        document.getElementById('modal-img').src = post.image;
        document.getElementById('modal-date').textContent = post.date;
        document.getElementById('modal-title').textContent = post.title;
        // Eğer uzun içerik (fullContent) varsa onu koy, yoksa özeti koy
        document.getElementById('modal-text').innerHTML = post.fullContent || `<p>${post.summary}</p>`;

        // Modalı göster
        const modal = document.getElementById('blog-modal');
        modal.classList.add('active');
        document.body.style.overflow = 'hidden'; // Arka plan kaydırmayı kilitle
    }

    function closeBlogModal() {
        const modal = document.getElementById('blog-modal');
        modal.classList.remove('active');
        document.body.style.overflow = 'auto'; // Kaydırmayı aç
    }

    // Modalın dışına (siyah alana) tıklanırsa kapat
    document.getElementById('blog-modal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeBlogModal();
        }
    });

    // === 4. ADMIN PANEL FONKSİYONLARI ===
    function toggleAdminPanel() {
        const panel = document.getElementById('admin-panel-container');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    function publishBlogPost() {
        const title = document.getElementById('blog-title').value;
        const img = document.getElementById('blog-image').value || 'assets/for_hero.webp';
        const date = document.getElementById('blog-date').value || new Date().toISOString().split('T')[0];
        const content = document.getElementById('blog-content').value;

        if(title.trim() === "" || content.trim() === "") {
            alert("Başlık ve içerik zorunludur.");
            return;
        }

        // Yeni yazı objesi
        const newPost = {
            id: Date.now(), // Benzersiz ID
            title: title,
            image: img,
            date: date,
            summary: content.substring(0, 100) + "...", // Otomatik özet
            fullContent: content
        };

        // Local Storage'a kaydet
        let localPosts = JSON.parse(localStorage.getItem('goldenBlogData')) || [];
        localPosts.push(newPost);
        localStorage.setItem('goldenBlogData', JSON.stringify(localPosts));

        // Formu temizle
        document.getElementById('blog-title').value = "";
        document.getElementById('blog-content').value = "";
        
        alert("Yazı tarayıcı hafızasına kaydedildi!");
        loadBlogData(); // Sayfayı yenilemeden listeyi güncelle
    }

    // === BAŞLAT ===
    document.addEventListener('DOMContentLoaded', loadBlogData);

</script>

</body>
</html>
