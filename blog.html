<!-- Bu kodu blog.html dosyanızın sonundaki <script> bölümünün yerine koyun -->

<script>
    let allBlogPosts = [];

    // 1. Verileri Çek (JSON'dan veya Yedek veriden)
    async function fetchBlogPosts() {
        try {
            const response = await fetch('data/blog-posts.json');
            if (!response.ok) throw new Error('JSON okunamadı');
            allBlogPosts = await response.json();
            renderBlogGrid(allBlogPosts);
        } catch (error) {
            console.warn("JSON verisi alınamadı, yedek veri kullanılıyor:", error);
            // Fallback / Yedek Veri
            allBlogPosts = [
                {
                    "id": 1,
                    "title": "Kapadokya'da Balon Turu Deneyimi",
                    "image": "assets/kapadokya-balon-turu-1.webp",
                    "date": "2025-10-15",
                    "category": "GEZİ REHBERİ",
                    "summary": "Peri bacalarının üzerinde gün doğumunu izlemek...",
                    "fullContent": "<p>Peri bacalarının üzerinde gün doğumunu izlemek hayatınızda yaşayabileceğiniz en büyüleyici deneyimlerden biri. Sabahın ilk ışıklarıyla birlikte gökyüzüne yükselen yüzlerce balon, Kapadokya'nın eşsiz coğrafyasını bir masal diyarına dönüştürüyor.</p><p><strong>Ne Zaman Gidilmeli?</strong><br>En iyi sezon Nisan-Ekim arasıdır ancak kışın karlar altındaki manzarası da ayrı bir güzeldir.</p>"
                },
                {
                    "id": 2,
                    "title": "Vizesiz Gidilebilecek 10 Cennet Ülke",
                    "image": "assets/antalya-koy-gezisi-1.webp",
                    "date": "2025-09-20",
                    "category": "İPUÇLARI",
                    "summary": "Pasaportunuzu kapıp hemen yola çıkabileceğiniz...",
                    "fullContent": "<p>Vize prosedürleriyle uğraşmadan tatil yapmanın keyfi paha biçilemez. İşte en güzel vizesiz destinasyonlar...</p>"
                },
                {
                    "id": 3,
                    "title": "Avrupa Turu İçin Çanta Hazırlama Rehberi",
                    "image": "assets/spain-1.webp",
                    "date": "2025-08-05",
                    "category": "REHBER",
                    "summary": "Uzun bir Avrupa seyahatine çıkarken...",
                    "fullContent": "<p>Kapsül gardırop sistemi ile hafif seyahat edin. 3 üst, 2 alt, 1 ayakkabı yeterli!</p>"
                }
            ];
            renderBlogGrid(allBlogPosts);
        }
    }

    // 2. Blog Kartlarını Ekrana Basma
    function renderBlogGrid(posts) {
        const container = document.getElementById('blog-grid-display');
        container.innerHTML = ""; 

        if(!posts || posts.length === 0) {
            container.innerHTML = "<p style='text-align:center; color:#888; grid-column:1/-1;'>Henüz blog yazısı eklenmemiş.</p>";
            return;
        }

        // Tarihe göre sırala (Yeniden eskiye)
        posts.sort((a, b) => new Date(b.date) - new Date(a.date));

        posts.forEach(post => {
            const excerpt = (post.summary || post.description || '').substring(0, 150) + '...';
            
            const html = `
                <article class="blog-card" onclick="openModal(${post.id})">
                    <img src="${post.image}" alt="${post.title}" loading="lazy" 
                         onerror="this.src='https://placehold.co/400x250/38bdf8/FFF?text=WalkAbout'">
                    <div class="blog-content">
                        <span class="blog-date">${post.date}</span>
                        <h3 class="blog-title">${post.title}</h3>
                        <p class="blog-summary">${excerpt}</p>
                        <span class="read-more">Devamını Oku →</span>
                    </div>
                </article>
            `;
            container.innerHTML += html;
        });
    }

    // 3. Modalı Açma (Detay Gösterme)
    function openModal(postId) {
        console.log('Opening modal for post:', postId);
        
        const post = allBlogPosts.find(p => p.id == postId);
        
        if (!post) {
            console.error('Post bulunamadı:', postId);
            return;
        }

        // Modal elemanlarını bul
        const modal = document.getElementById('blog-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalDate = document.getElementById('modal-date');
        const modalImg = document.getElementById('modal-img');
        const modalContent = document.getElementById('modal-full-content');

        if (!modal) {
            console.error('Modal element bulunamadı!');
            return;
        }

        // İçerikleri doldur
        if (modalTitle) modalTitle.textContent = post.title;
        if (modalDate) modalDate.textContent = `${post.date} ${post.category ? '• ' + post.category : ''}`;
        if (modalImg) modalImg.src = post.image;
        if (modalContent) {
            modalContent.innerHTML = post.fullContent || post.content || post.description || post.summary;
        }

        // Modal'ı göster
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        console.log('Modal açıldı');
    }

    // 4. Modalı Kapatma
    function closeModal() {
        const modal = document.getElementById('blog-modal');
        if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }
    }

    // Modal dışına tıklanınca kapat
    document.addEventListener('DOMContentLoaded', () => {
        const modal = document.getElementById('blog-modal');
        if (modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // ESC tuşu ile kapat
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // Sayfaya yüklendiğinde blog'ları getir
        fetchBlogPosts();
    });

    // Global fonksiyon olarak tanımla
    window.openModal = openModal;
    window.closeModal = closeModal;
</script>
